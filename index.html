<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" type="text/css" href="./layui-v2.5.5/layui/css/layui.css" media="all"/>
	<link rel="stylesheet" href="css/index.css">
	<title>采房</title>
	<style type="text/css">
	</style>
</head>
<body>
	<!-- 轮播 -->
	<div class="layui-carousel" id="test1">
	  <div carousel-item>
	    <div class="carousel-imgs"></div>
		<div class="carousel-imgs1"></div>
	  </div>
	 <!-- 导航栏		 -->	
	 <!-- <iframe  MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="./pages/header.html" height="100px" width="100%" style="position:absolute; top:-2px;color:#000;"></iframe> -->
	<div class="topNav">
	 		    <div class="topNav-left">
	 				<img src="img/logo.png" class="topNav-img">	
	 			</div>		
	 			<div class="topNav-right">
	 				<div class="topNav-line" >
	 					<a href="javascript:void(0);">新房</a>|
	 					<a href="javascript:void(0);" id="xcx">小程序</a>
	 					<div id="xcxImgs">
	 						<img src="img/ewm.jpg" >
	 					</div>
	 				</div>
	 					<img src="img/login-icon.png" class="login-icon">
	 					<div class="login-box"></div>
	 			</div>	
	 </div>
	</div>
	
	<!-- 热卖新房 -->
	<div class="index-newHouse">
		<div>
			<div class="index-sonDiv">
				<div>
					<span class="index-newHouseSon">热卖新房</span> 
					<span class="index-newHouseSpecial">享受平台专特价</span>
				</div>
				<div ><a href="./pages/more.html" class="index-seeMore">查看更多>></a></div>
			</div>
			
			<!-- <div class="index-newHouse-son1">
				<button type="button" class="layui-btn layui-btn-primary">桂城</button>
				<button type="button" class="layui-btn layui-btn-primary">朝安</button>
				<button type="button" class="layui-btn layui-btn-primary">三水</button>
				<button type="button" class="layui-btn layui-btn-primary">桂城</button>
				<button type="button" class="layui-btn layui-btn-primary">千灯湖</button>
			</div> -->
		</div>
		<div class="hotHourseImg-box">
			<ul>
				<li><img></li>
				<li><img ></li>
				<li><img ></li>
			</ul>
		</div>
		
	</div>
	<!-- 热卖新房end -->
	
	
	<!-- 经纪人推荐 -->
		<div class="index-agent">
			<div class="index-agent-box">
				<div>
					<div class="index-agent-type">
						<div>
							<span class="index-find-agent">找好经纪</span> 
							<span class="index-newHouseSpecial">经纪全网经纪人直卖平台，找好经纪买好房</span>
						</div>
						<div> </div>
					</div>
				</div>
				
				<div class="index-agent-box">
					<ul>
						<li >
							<div class="index-agent-center">
								<img src="./img/sale1.jpg">
								<div>刘铭</div>
								<div class="index-agent-phone">电话: 15360664445</div>
								<div class="index-agent-type">
									<button type="button" class="layui-btn layui-btn-xs">开车看房</button>
									<button type="button" class="layui-btn layui-btn-xs">投资指导</button>
									<button type="button" class="layui-btn layui-btn-xs">首付金融</button>
								</div>
								<div>
									<button type="button" class="layui-btn layui-btn-primary" onclick="openKF()" >我要咨询</button>
								</div>
							</div>
						</li>
						<li >
							<div class="index-agent-center">
								<img src="./img/sale2.jpg">
								<div>刘铭</div>
								<div class="index-agent-phone">电话: 15360664445</div>
								<div class="index-agent-type">
									<button type="button" class="layui-btn layui-btn-xs">开车看房</button>
									<button type="button" class="layui-btn layui-btn-xs">投资指导</button>
									<button type="button" class="layui-btn layui-btn-xs">首付金融</button>
								</div>
								<div>
									<button type="button" class="layui-btn layui-btn-primary" onclick="openKF()" >我要咨询</button>
								</div>
							</div>
						</li>
						<li >
							<div class="index-agent-center">
								<img src="./img/sale3.jpg">
								<div>刘铭</div>
								<div class="index-agent-phone">电话: 15360664445</div>
								<div class="index-agent-type">
									<button type="button" class="layui-btn layui-btn-xs">开车看房</button>
									<button type="button" class="layui-btn layui-btn-xs">投资指导</button>
									<button type="button" class="layui-btn layui-btn-xs">首付金融</button>
								</div>
								<div>
									<button type="button" class="layui-btn layui-btn-primary" onclick="openKF()" >我要咨询</button>
								</div>
							</div>
						</li>
						<li >
							<div class="index-agent-center">
								<img src="./img/sale4.jpg">
								<div>刘铭</div>
								<div class="index-agent-phone">电话: 15360664445</div>
								<div class="index-agent-type">
									<button type="button" class="layui-btn layui-btn-xs">开车看房</button>
									<button type="button" class="layui-btn layui-btn-xs">投资指导</button>
									<button type="button" class="layui-btn layui-btn-xs">首付金融</button>
								</div>
								<div>
									<button type="button" class="layui-btn layui-btn-primary" onclick="openKF()" >我要咨询</button>
								</div>
							</div>
						</li>
						<li >
							<div class="index-agent-center">
								<img src="./img/sale5.jpg">
								<div>刘铭</div>
								<div class="index-agent-phone">电话: 15360664445</div>
								<div class="index-agent-type">
									<button type="button" class="layui-btn layui-btn-xs">开车看房</button>
									<button type="button" class="layui-btn layui-btn-xs">投资指导</button>
									<button type="button" class="layui-btn layui-btn-xs">首付金融</button>
								</div>
								<div>
									<button type="button" class="layui-btn layui-btn-primary" onclick="openKF()" >我要咨询</button>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	<!-- 经纪人推荐--->
	
	<!-- 优选新房 -->
	<div class="index-optimization">
		<div>
			<div class="index-optimization-newHose">
				<div>
					<span class="index-optimization-newHose-type">优选新房</span> 
					<span class="index-newHouseSpecial">优先新房为你推荐</span>
				</div>
				<div ><a href="./pages/more.html" class="index-seeMore">查看更多>> </a></div>
			</div>
		</div>
		<div id="YXhourse">
			
			
		</div>
		<div style="text-align: center;"><button type="button" class="layui-btn layui-btn-primary  layui-btn-lg index-seeMore">查看更多>></button></div>
	</div>
	<!-- 优选新房end -->
	<!-- 页脚 -->
	<iframe  MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no src="./pages/footer.html" height="200px" width="100%"></iframe>
	<!-- <footer class="index-footer" >
		<div class="footer-center">
			<div class="footer-title">佛山市采房有限公司</div>
			<div style="padding-top: 20px;">
				<a href="javascript：void(0)" target="_blank">关于我们</a> | 
				<a href="javascript：void(0)" target="_blank">联系我们</a> |
				<a href="javascript：void(0)" target="_blank">用户协议</a> | 
				<a href="javascript：void(0)" target="_blank">友情链接</a> |
				<a href="javascript：void(0)" target="_blank">广告服务</a> |
				<a href="javascript：void(0)" target="_blank">用户须知</a> | 
				<a href="javascript：void(0)" target="_blank">异常反馈</a> |
				<a href="javascript：void(0)" target="_blank">营业执照</a>
			</div>
			<div class="footer-foot">
				Copyright©2019 粤ICP备19025915号
			</div>
		</div>
	</footer> -->
</body>

<script src="./lib/jquery3.41.js" type="text/javascript" charset="utf-8"></script>
<script src="./layui-v2.5.5/layui/layui.js" type="text/javascript" charset="utf-8"></script>
<script>
	//域名
	var serverUrl = 'http://47.113.113.156:8080/'
	var msmCode = ''	//手机验证码
	
	// 轮播图
	layui.use('carousel', function(){
	  var carousel = layui.carousel;
	  //建造实例
	  carousel.render({
	    elem: '#test1',
	    width: '100%',
		height:'600px',
	    arrow: 'always' //始终显示箭头
	    //,anim: 'updown' //切换动画方式
	  });
	});
	
	// 经纪人
	layui.use('carousel', function(){
	  var carousel = layui.carousel;
	  //建造实例
	  carousel.render({
	    elem: '#test2',
	    width: '100%',
		height:'300px',
		autoplay:false,
		indicator:'none',
	    // arrow: 'always' //始终显示箭头
	    //,anim: 'updown' //切换动画方式
	  });
	});
	
	//登录框
	function login(){
		layui.use('layer', function(){
		  var layer = layui.layer;
		  layer.open({
			title:"用户登录",  
		    type: 1, 
		    content: `
				<form class="layui-form" action="#" style="height: 360px; width: 360px;"> 
					<div class="layui-form-item login-line">
						<label class="layui-form-label">手机号</label>
						<div class="layui-input-block">
							<input type="text" name="phone" maxlength="11" lay-verify="required|phone maxlength="11" id="longinPhone" placeholder="请输入您的手机号" autocomplete="off" class="layui-input">
						</div>
					</div>
				    <div class="layui-form-item login-line">
						<label class="layui-form-label">短信验证码</label>
						  <div class="layui-input-block">
							<input type="text" name="code" maxlength="6" placeholder="请输入短信验证码" autocomplete="off" class="layui-input">
							<button type="button" id="loginBtnText" class="layui-btn layui-btn-primary" onclick="getLoginCode()">获取验证码</button>
						</div>
				    </div>
					<div class="layui-input-block">
					    <button class="layui-btn layui-btn-warm" lay-submit lay-filter="loginFrom">立即登录</button>
					</div>
					<a style="display: flex;justify-content: flex-end; margin-right:50px" href="http://925029931.com" target="_blank">经纪人登录</a>
				</form>
			`
		  });
		});              
	}
	
	// 注册框
	function register(){
		layui.use('layer', function(){
		  var layer = layui.layer;
		  // layer.title('牛皮膏药',1),
		  layer.open({
			title:"用户注册",
		    type: 1, 
		    content: `<form class="layui-form" action="#" style="height: 360px; width: 360px;">
						<div class="layui-form-item login-line">
							<label class="layui-form-label">用户名/姓名</label>
							  <div class="layui-input-block">
								<input type="text" name="number" placeholder="姓名" lay-verify="required" autocomplete="off" class="layui-input">
							</div>
						</div>
						
						<div class="layui-form-item login-line">
							<label class="layui-form-label">手机号</label>
							  <div class="layui-input-block">
								<input type="text" name="phone" placeholder="手机号" lay-verify="required|phone" id="phoneNum" autocomplete="off" class="layui-input">
							</div>
						</div>
						
						<div class="layui-form-item">
							<label class="layui-form-label">密码</label>
							  <div class="layui-input-block">
								<input type="text" name="password" placeholder="密码" lay-verify="required|number"   autocomplete="off" class="layui-input">
							</div>
						</div>
						
						<label class="layui-form-label">短信验证码</label>
						  <div class="layui-input-block">
							<input type="text" name="code" placeholder="请输入短信验证码" maxlength="6" autocomplete="off" class="layui-input">
							<button type="button" class="layui-btn layui-btn-primary" id="registerBtnText" onclick="getRegisterCode()">获取验证码</button>
						</div>
						
						<div class="layui-input-block" style="margin-top:10px">
						    <button class="layui-btn layui-btn-warm" lay-submit lay-filter="registerForm" >一键注册/登录</button>
						</div>
					</form>`
		  });
		});              
	};
	
	// 获取注册验证码
	function getRegisterCode(){
		var phone = $('#phoneNum').val();
		if(!(/^1(3|4|5|6|7|8|9)\d{9}$/.test(phone))){ 
		    alert("手机号码有误，请重填");  
		}else{
			$.ajax({
				type:"post",
				url: serverUrl+'cf-user/getRegisterCaptcha',
				dataType:'json',
				data:{"phone":phone},
				success:function(res){
					if(res.code == 200){
						//返回在验证码放到全局变量
						msmCode = res.data
						// 倒计时
						let timedown = 60
						$('#registerBtnText').text(`${timedown}s`)
						let time = window.setInterval(function(){
							if(timedown<=0){
								clearInterval(time)
								$('#registerBtnText').text(`重新获取验证码`)
								return
							}
							timedown -= 1
							$('#registerBtnText').text(`${timedown}s`)
						},1000)
					}else{
						alert('获取失败')
					}
				}
			});	
		}
	}
	
	// 获取登录验证码
	function getLoginCode(){
		var phone = $('#longinPhone').val();
		if(!(/^1(3|4|5|6|7|8|9)\d{9}$/.test(phone))){ 
		    alert("手机号码有误，请重填");  
		}else{
			$.ajax({
				type:"post",
				url: serverUrl+'/cf-user/getLoginCaptcha',
				dataType:'json',
				data:{"phone":phone},
				success:function(res){
					if(res.code == 200){
						//返回在验证码放到全局变量
						msmCode = res.data
						// 倒计时
						let timedown = 60
						$('#loginBtnText').text(`${timedown}s`)
						let time = window.setInterval(function(){
							if(timedown<=0){
								clearInterval(time)
								$('#loginBtnText').text(`重新获取验证码`)
								return
							}
							timedown -= 1
							$('#loginBtnText').text(`${timedown}s`)
						},1000)
					}else{
						alert('获取失败')
					}
				}
			});	
		}
	}
	
	// 注册表单校验
	layui.use('form', function(){
	  var form = layui.form;
	  var layer = layui.layer;
	  // 确定提交表单
	  form.on('submit(registerForm)', function(data){
		let number = data.field.number
		let phone = data.field.phone
		let password = data.field.password
		let code =  data.field.code
		console.log(`用户名:${number}+手机号:${phone}+验证码:${code}+ 密码:${password}`);
		if(msmCode!=code){
			alert('验证码错误')
		}else{
			$.ajax({
				type:'post',
				url:serverUrl+"/cf-user/register",
				dataType:'json',
				data:{
					"number":number,
					"phone":phone,
					"password":password,
				},
				xhrFields: {
					withCredentials: false
				},
				success:function(res){
					if(res.code==200){
						$('.login-box').children().empty()
						$('.login-box').append(`<span onclick="myMsg()">${phone}</span> / <span onclick="Logout()">退出</span>`)
						localStorage.setItem("phone", phone);
						console.log(msmCode)
						layer.closeAll();
					}
				}
			})
		}
		return false;
	  });
	});
	
	// 登录表单验证
	layui.use('form', function(){
	  var form = layui.form;
	  var layer = layui.layer;
	  // 确定提交表单
	  form.on('submit(loginFrom)', function(data){
		let phone = data.field.phone
		let code =  data.field.code
		console.log(`手机号:${phone}+验证码:${code}`);
		if(msmCode!=code){
			alert('验证码错误')
		}else{
			$.ajax({
				type:'post',
				url:serverUrl+"/cf-user/phoneLogin",
				dataType:'json',
				data:{
					"phone":phone,
				},
				success:function(res){
					if(res.code==200){
						$('.login-box').children().empty()
						$('.login-box').append(`<span onclick="myMsg()">${phone}</span> / <span onclick="Logout()">退出</span>`)
						localStorage.setItem("phone", phone);
						layer.closeAll();
					}
				}
			})
		}
		return false;
	  });
	});
	
	//退出登录
	function Logout(){
		localStorage.removeItem("phone");　　
		console.log('退出')
		hasLogin()
	}
	
	// 判断用户是有有登录
	function hasLogin(){
		var	phoneStorage = localStorage.getItem('phone')
		if(phoneStorage!=null){
			$('.login-box').children().empty()
			$('.login-box').append(`<div><span onclick="myMsg()">${phoneStorage}</span> / <span onclick="Logout()">退出</span></div>`)
		}else{
			$('.login-box').children().empty()
			$('.login-box').append(`<div><a href="javascript:void(0)" onclick="login()">登录</a> / <a href="javascript:void(0)" onclick="register()">注册</a></div>`)
		}
		console.log(phoneStorage)
	}
	
	//焦点获取
	$('#xcx').mouseenter(function(){
		$('#xcxImgs').show()
	}).mouseout(function(){
		$('#xcxImgs').hide()
	})
	
	/*----------------------渲染优选新房---------------------------*/
	function getHourse(){
		$.ajax({
			type:'post',
			url:serverUrl+"/cf-new-house/findAll",
			data:{
				offset:1,
				pagesize:8
			},
			success:function(res){
				console.log(res.data)
				
				for(var item of res.data){	
					var coverImg;
					if(item.cfEffectImgs[0].effectImg!=undefined){
						coverImg = item.cfEffectImgs[0].effectImg
					}
					console.log(coverImg)
					let divItem =`<div style="width: 265px;height: 270px;" onclick="detail(${item.cfNewHouse.id})">
									<img src="${coverImg}" style="width: 265px;height: 205px; border-radius: 7px;" >
									<div>${item.cfNewHouse.estateName}</div>
									<div style="display: flex;justify-content: space-between;">
										<div style="font: 15px;color: #A8A8A8;">${item.cfNewHouse.estateDistrict}/3室2厅</div>
										<div style="font: 20px;color: #00FF00;">${item.cfNewHouse.totalPrice}元起</div>
									</div>
								</div>`
					$('#YXhourse').append(divItem)
				}
				
			}
		})
	}
	
	// 去详情页
	function detail(e){
		window.location.href = "./pages/detail.html?id="+e
	}

	// 打开咨询弹框
	function openKF(){
		layui.use('layer', function(){
			var layer = layui.layer;					
			layer.open({
				title:"手机号快捷咨询",
				type: 1, 
				content: `<form class="layui-form" action="#">
							<div class="layui-form-item">
								<label class="layui-form-label">姓名</label>
								<div class="layui-input-block">
								<input type="text" name="username" required  lay-verify="required" placeholder="请输入您的姓名" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">手机号</label>
								<div class="layui-input-inline">
								<input type="number" name="password" required lay-verify="required" placeholder="请输入你的手机号" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<button class="layui-btn" lay-submit lay-filter="zixunFrom">立即提交</button>
								</div>
							</div>
						</form>`
			});
		});            
	}

	//验证咨询框
	layui.use('form', function(){
	  var form = layui.form;
	  // 确定提交表单
	  form.on('submit(zixunFrom)', function(data){
		console.log(data.field.username)
		console.log(data.field.password)
		return false 
	  });
	});
	

	// 查看是否有登录
	$(function(){
		hasLogin()
		getHourse()
	})
</script>

</html>